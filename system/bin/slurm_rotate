#!/bin/bash

# slurm_rotate
# Matt Allbright
# Simple utility to read logs from slurm nodes over network. Similar to slurm_fetch,
# slurm_rotate reads the most up to date logs by ssh'ing into other nodes.

clear

echo -e "controller daemon @ hope\n"
ssh root@hope tail -n 30 /var/log/slurm-llnl/slurmctld.log

echo -e "\n"
read -n1 -r -p "Press space to continue..." next

if [[ "$next" = '' ]]; then
	break
fi

clear

echo -e "worker daemon @ hope\n"
ssh root@hope tail -n 30 /var/log/slurm-llnl/slurmd.log

echo -e "\n"
read -n1 -r -p "Press space to continue..." next

if [[ "$next" = '' ]]; then
        break
fi

clear

echo -e "database daemon @ hope\n"
ssh root@hope tail -n 30 /var/log/slurm-llnl/slurmdbd.log

echo -e "\n"
read -n1 -r -p "Press space to continue..." next

if [[ "$next" = '' ]]; then
	break
fi

clear

echo -e "controller daemon @ empire\n"
ssh root@empire tail -n 30 /var/log/slurm-llnl/slurmctld.log

echo -e "\n"
read -n1 -r -p "Press space to continue..." next

if [[ "$next" = '' ]]; then
        break
fi

clear

echo -e "worker daemon @ empire\n"
ssh root@empire tail -n 30 /var/log/slurm-llnl/slurmd.log

echo -e "\n"
read -n1 -r -p "Press space to continue..." next

if [[ "$next" = '' ]]; then
	break
fi

clear

echo -e "worker daemon @ jedi\n"
ssh root@jedi tail -n 30 /var/log/slurm-llnl/slurmd.log

echo -e "\n"
read -n1 -r -p "Press space to continue..." next

if [[ "$next" = '' ]]; then
	break
fi

clear

echo -e "worker daemon @ hyperion\n"
ssh root@hyperion tail -n 30 /var/log/slurm-llnl/slurmd.log

echo -e "\n"
read -n1 -r -p "Press space to continue..." next

if [[ "$next" = '' ]]; then
	break
fi

# clear
#
# echo -e "worker daemon @ norman\n"
# ssh root@norman tail -n 30 /var/log/slurm-llnl/slurmd.log
#
# echo -e "\n"
# read -n1 -r -p "Press space to continue..." next
#
# if [[ "$next" = '' ]]; then
# 	break
# fi

# clear
#
# echo -e "worker daemon @ wilbur\n"
# ssh root@wilbur tail -n 30 /var/log/slurm-llnl/slurmd.log
#
# echo -e "\n"
# read -n1 -r -p "Press space to continue..." next
#
# if [[ "$next" = '' ]]; then
# 	break
# fi

# clear
#
# echo -e "worker daemon @ rufus\n"
# ssh root@rufus tail -n 30 /var/log/slurm-llnl/slurmd.log
#
# echo -e "\n"
# read -n1 -r -p "Press space to continue..." next
#
# if [[ "$next" = '' ]]; then
# 	break
# fi

/opt/cloud/staging/system/bin/slurm_rotate
